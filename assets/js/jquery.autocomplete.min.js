function getCrosAutoJson(e,t,n,s){navigator.userAgent;$.ajax({url:e,type:n.type,contentType:"application/json",dataType:"json",cache:!1,ifModified:!0,beforeSend:function(){$("#autocomplete-ajax").css("background-image","url(http://m.st.wthr.ws/assets/images/mobile-theme/loading_transparent/autocomplete.gif)").css("background-position","left").css("background-repeat","no-repeat").css("opacity","0.6"),_gaq.push(["_trackEvent","mobileAutocomplete","request",t])}}).done(function(e){$("#autocomplete-ajax").css("background-image","none"),s(e)}).fail(function(e,s,i){n.onSearchError.call(that.element,t,e,s,i),$("#autocomplete-ajax").css("background-image","none")})}!function(){"use strict";function e(t,n){var s=function(){},i=this,o={autoSelectFirst:!0,flags:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,width:"auto",minChars:2,maxHeight:300,deferRequestBy:650,params:{},formatResult:e.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:s,onSearchComplete:s,onSearchError:s,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,lookupFilter:function(e,t,n){return-1!==e.value.toLowerCase().indexOf(n)},paramName:"query",transformResult:function(e){return"string"==typeof e?$.parseJSON(e):e}};i.element=t,i.el=$(t),i.suggestions=[],i.badQueries=[],i.selectedIndex=-1,i.currentValue=i.element.value,i.intervalId=0,i.cachedResponse=[],i.onChangeInterval=null,i.onChange=null,i.isLocal=!1,i.suggestionsContainer=null,i.options=$.extend({},o,n),i.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},i.hint=null,i.hintValue="",i.selection=null,i.initialize(),i.setOptions(n)}var t=function(){return{escapeRegExChars:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}}}(),n={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};e.utils=t,$.Autocomplete=e,e.formatResult=function(e,n){var s="("+t.escapeRegExChars(n)+")";return e.value.replace(new RegExp(s,"gi"),"<strong>$1</strong>")},e.prototype={killerFn:null,initialize:function(){var t,n=this,s="."+n.classes.suggestion,i=n.classes.selected,o=n.options;n.element.setAttribute("autocomplete","off"),n.killerFn=function(e){0===$(e.target).closest("."+n.options.containerClass).length&&(n.killSuggestions(),n.disableKillerFn())},n.suggestionsContainer=e.utils.createNode('<div class="'+o.containerClass+'" style="position: absolute; display: none;"></div>'),t=$(n.suggestionsContainer),t.appendTo(o.appendTo),"auto"!==o.width&&t.width(o.width),t.on("mouseover.autocomplete",s,function(){n.activate($(this).data("index"))}),t.on("mouseout.autocomplete",function(){n.selectedIndex=-1,t.children("."+i).removeClass(i)}),t.on("click.autocomplete",s,function(){n.select($(this).data("index"))}),n.fixPosition(),n.fixPositionCapture=function(){n.visible&&n.fixPosition()},$(window).bind("resize",n.fixPositionCapture),n.el.bind("input keydown.autocomplete,input keypress.autocomplete",function(e){n.onKeyPress(e)}),n.el.bind("input keyup.autocomplete",function(e){n.onKeyUp(e)}),n.el.bind("input blur.autocomplete",function(){n.onBlur()}),n.el.bind("input focus.autocomplete",function(){n.fixPosition()}),n.el.bind("input change.autocomplete",function(e){n.onKeyUp(e)})},onBlur:function(){this.enableKillerFn()},setOptions:function(e){var t=this,n=t.options;$.extend(n,e),t.isLocal=$.isArray(n.lookup),t.isLocal&&(n.lookup=t.verifySuggestionsFormat(n.lookup)),$(t.suggestionsContainer).css({"max-height":n.maxHeight+"px",width:n.width+"px","z-index":n.zIndex})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var e,t=this;"body"===t.options.appendTo&&(e=t.el.offset(),$(t.suggestionsContainer).css({top:e.top+t.el.outerHeight()+"px",left:e.left+"px"}))},enableKillerFn:function(){var e=this;$(document).on("click.autocomplete",e.killerFn)},disableKillerFn:function(){var e=this;$(document).off("click.autocomplete",e.killerFn)},killSuggestions:function(){var e=this;e.stopKillSuggestions(),e.intervalId=window.setInterval(function(){e.hide(),e.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var e,t=this,n=t.el.val().length,s=t.element.selectionStart;return"number"==typeof s?s===n:document.selection?(e=document.selection.createRange(),e.moveStart("character",-n),n===e.text.length):!0},onKeyPress:function(e){var t=this;if(!t.disabled&&!t.visible&&e.which===n.DOWN&&t.currentValue)return void t.suggest();if(!t.disabled&&t.visible){switch(e.which){case n.ESC:t.el.val(t.currentValue),t.hide();break;case n.RIGHT:if(t.hint&&t.options.onHint&&t.isCursorAtEnd()){t.selectHint();break}return;case n.TAB:if(t.hint&&t.options.onHint)return void t.selectHint();case n.RETURN:if(-1===t.selectedIndex)return void t.hide();if(t.select(t.selectedIndex),e.which===n.TAB&&t.options.tabDisabled===!1)return;break;case n.UP:t.moveUp();break;case n.DOWN:t.moveDown();break;default:return}e.stopImmediatePropagation(),e.preventDefault()}},onKeyUp:function(e){var t=this;if(!t.disabled){switch(e.which){case n.UP:case n.DOWN:return}clearInterval(t.onChangeInterval),t.currentValue!==t.el.val()&&(t.findBestHint(),t.options.deferRequestBy>0?t.onChangeInterval=setInterval(function(){t.onValueChange()},t.options.deferRequestBy):t.onValueChange())}},onValueChange:function(){var e,t=this;t.selection&&(t.selection=null,(t.options.onInvalidateSelection||$.noop)()),clearInterval(t.onChangeInterval),t.currentValue=t.el.val(),e=t.getQuery(t.currentValue),t.selectedIndex=-1,e.length<t.options.minChars?t.hide():t.getSuggestions(e)},getQuery:function(e){var t,n=this.options.delimiter;return n?(t=e.split(n),$.trim(t[t.length-1])):$.trim(e)},getSuggestionsLocal:function(e){var t=this,n=e.toLowerCase(),s=t.options.lookupFilter;return{suggestions:$.grep(t.options.lookup,function(t){return s(t,e,n)})}},getSuggestions:function(e){var t,n=this,s=n.options,i=s.serviceUrl;if(t=n.isLocal?n.getSuggestionsLocal(e):n.cachedResponse[e],t&&$.isArray(t.suggestions))n.suggestions=t.suggestions,n.suggest();else if(!n.isBadQuery(e)){if(s.params[s.paramName]=e,s.onSearchStart.call(n.element,s.params)===!1)return;$.isFunction(s.serviceUrl)&&(i=s.serviceUrl.call(n.element,e)),null!=this.currentRequest&&this.currentRequest.abort(),i+=encodeURI(e)+"/"+s.params.cid,i=i,this.currentRequest=getCrosAutoJson(i,e,s,function(t){n.processResponse(t,e),s.onSearchComplete.call(n.element,e)})}},isBadQuery:function(e){for(var t=this.badQueries,n=t.length;n--;)if(0===e.indexOf(t[n]))return!0;return!1},hide:function(){var e=this;e.visible=!1,e.selectedIndex=-1,$(e.suggestionsContainer).hide(),e.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var e,t=this,n=t.options.formatResult,s=t.getQuery(t.currentValue),i=t.classes.suggestion,o=t.classes.selected,a=$(t.suggestionsContainer),l="";$.each(t.suggestions,function(e,o){var a=e%2==0?" odd":" even";l+=t.options.flags?'<div class=" '+i+a+'" data-index="'+e+'" style="height:22px;line-height:22px;"> <div style="float:left;background-image:url(http://m.st.wthr.ws/assets/images/mobile-theme/all-zoomed.png);background-repeat: no-repeat; width:88px;height:88px;zoom:25%;-moz-transform:scale(.25);-moz-transform-origin:0 0;" class="flag '+o.suggested.prefix+'"></div>'+n(o,s)+"</div>":'<div class="'+i+a+'" data-index="'+e+'">'+n(o,s)+"</div>"}),"auto"===t.options.width&&(e=t.el.outerWidth()-2,a.width(e>0?e:300)),a.html(l).show(),t.visible=!0,t.options.autoSelectFirst&&(t.selectedIndex=0,a.children().first().addClass(o)),t.findBestHint()},findBestHint:function(){var e=this,t=e.el.val().toLowerCase(),n=null;t&&($.each(e.suggestions,function(e,s){var i=0===s.value.toLowerCase().indexOf(t);return i&&(n=s),!i}),e.signalHint(n))},signalHint:function(e){var t="",n=this;e&&(t=n.currentValue+e.value.substr(n.currentValue.length)),n.hintValue!==t&&(n.hintValue=t,n.hint=e,(this.options.onHint||$.noop)(t))},verifySuggestionsFormat:function(e){return e.length&&"string"==typeof e[0]?$.map(e,function(e){return{value:e,data:null}}):e},processResponse:function(e,t){var n=this,s=n.options,i=s.transformResult(e,t);i.suggestions=n.verifySuggestionsFormat(i.suggestions),s.noCache||(n.cachedResponse[i[s.paramName]]=i,0===i.suggestions.length&&n.badQueries.push(i[s.paramName])),t===n.getQuery(n.currentValue)&&(n.suggestions=i.suggestions,n.suggest())},activate:function(e){var t,n=this,s=n.classes.selected,i=$(n.suggestionsContainer),o=i.children();return i.children("."+s).removeClass(s),n.selectedIndex=e,-1!==n.selectedIndex&&o.length>n.selectedIndex?(t=o.get(n.selectedIndex),$(t).addClass(s),t):null},selectHint:function(){var e=this,t=$.inArray(e.hint,e.suggestions);e.select(t)},select:function(e){var t=this;t.hide(),t.onSelect(e)},moveUp:function(){var e=this;if(-1!==e.selectedIndex)return 0===e.selectedIndex?($(e.suggestionsContainer).children().first().removeClass(e.classes.selected),e.selectedIndex=-1,e.el.val(e.currentValue),void e.findBestHint()):void e.adjustScroll(e.selectedIndex-1)},moveDown:function(){var e=this;e.selectedIndex!==e.suggestions.length-1&&e.adjustScroll(e.selectedIndex+1)},adjustScroll:function(e){var t,n,s,i=this,o=i.activate(e),a=25;o&&(t=o.offsetTop,n=$(i.suggestionsContainer).scrollTop(),s=n+i.options.maxHeight-a,n>t?$(i.suggestionsContainer).scrollTop(t):t>s&&$(i.suggestionsContainer).scrollTop(t-i.options.maxHeight+a),i.el.val(i.getValue(i.suggestions[e].value)),i.signalHint(null))},onSelect:function(e){var t=this,n=t.options.onSelect,s=t.suggestions[e];t.currentValue=t.getValue(s.value),t.el.val(t.currentValue),t.signalHint(null),t.suggestions=[],t.selection=s,_gaq.push(["_trackEvent","mobileAutocomplete","selected",t.currentValue]),$.isFunction(n)&&n.call(t.element,s)},getValue:function(e){var t,n,s=this,i=s.options.delimiter;return i?(t=s.currentValue,n=t.split(i),1===n.length?e:t.substr(0,t.length-n[n.length-1].length)+e):e},dispose:function(){var e=this;e.el.off(".autocomplete").removeData("autocomplete"),e.disableKillerFn(),$(window).off("resize",e.fixPositionCapture),$(e.suggestionsContainer).remove()}},$.fn.autocomplete=function(t,n){var s="autocomplete";return 0===arguments.length?this.first().data(s):this.each(function(){var i=$(this),o=i.data(s);"string"==typeof t?o&&"function"==typeof o[t]&&o[t](n):(o&&o.dispose&&o.dispose(),o=new e(this,t),i.data(s,o))})}}($);